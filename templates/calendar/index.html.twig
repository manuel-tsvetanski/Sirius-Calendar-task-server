{% extends 'base.html.twig' %}

{% block title %}Calendar{% endblock %}

{% block body %}
    <h2>Select a Day and Time for Your Appointment</h2>

    <div id="calendar"></div>
{% endblock %}

{% block javascripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');

            var eventsArray = [
                {% for day in calendar %}
                    {% for slot in day.timeSlots %}
                        {
                            title: '{{ slot.available ? "Available" : "Booked" }}',
                            start: '{{ slot.time|date("Y-m-d\\TH:i:s") }}',  // Correct date format
                            url: '{{ slot.available ? path('appointment_new', { date: day.date|date('Y-m-d'), time: slot.time|date('H:i') })|raw : "#" }}',
                            color: '{{ slot.available ? "green" : "red" }}',
                            editable: false,
                            durationEditable: false
                        }{% if not loop.last %},{% endif %}
                    {% endfor %}
                    {% if not loop.last %},{% endif %}
                {% endfor %}
            ];

            console.log(eventsArray); // Debugging: Check the final array

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'timeGridWeek',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'timeGridDay,timeGridWeek,dayGridMonth'
                },
                timeZone: 'local',
                events: eventsArray,
                slotDuration: '01:00:00', // Each slot represents 1 hour
                allDaySlot: false, // Disable the all-day slot
                selectable: true, // Allow selecting time slots
                eventClick: function(info) {
                    console.log("Event clicked:", info.event); // Debugging line
                    if (info.event.url) {
                        console.log("Navigating to:", info.event.url); // Debugging line
                        window.location.href = info.event.url;
                    }
                    info.jsEvent.preventDefault(); // Prevent default behavior
                }
            });

            calendar.render();
        });
    </script>
{% endblock %}
